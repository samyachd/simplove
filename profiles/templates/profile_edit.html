{% extends 'base.html' %}
{% block title %}Modifier mon profil{% endblock %}

{% block extra_css %}
<style>
  .photo-preview {
    max-width: 150px;
    border-radius: var(--bs-border-radius);
    display: none;
  }
</style>
{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container">
    <div class="simplove-card" style="max-width:700px; margin:0 auto;">
      <h2 class="mb-4 text-center">Modifier mon profil</h2>

      {% if form.errors %}
        <div class="alert alert-danger simplove-alert-danger">
          Une erreur est survenue dans le formulaire. Merci de vérifier les champs.
        </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% for field in form %}
          <div class="simplove-form-group">
            {{ field.label_tag }}
            {{ field }}

            {% if field.name == "photo" %}
              <!-- Aperçu photo -->
              <div class="d-flex gap-3 align-items-center mt-2">
                <div class="text-center">
                  <p class="small mb-1">Actuelle</p>
                  {% if profile.photo %}
                    <img src="{{ profile.photo.url }}" alt="Actuelle" class="simplove-img-profile">
                  {% else %}
                    <img src="/media/img/default-profile.png" alt="Défaut" class="simplove-img-profile">
                  {% endif %}
                </div>
                <div class="text-center">
                  <p class="small mb-1">Nouvelle</p>
                  <img id="photo-preview" class="photo-preview" alt="Aperçu">
                </div>
              </div>
            {% endif %}

            {% if field.errors %}
              <div class="text-danger mt-1">{{ field.errors }}</div>
            {% endif %}
          </div>
        {% endfor %}

        <button type="submit" class="simplove-btn simplove-btn--primary simplove-btn--block">Enregistrer</button>
      </form>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const photoInput = document.querySelector('input[type="file"][name="photo"]');
  const preview = document.getElementById('photo-preview');

  if (photoInput) {
    photoInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          preview.src = ev.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
      }
    });
  }
});
</script>
{% endblock %}